<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="CreateOracleDatabase">
	<!-- Create statements -->
	<statement id="createTable1">
		<![CDATA[
		create table users (
			id integer not null primary key,
			username varchar(20) unique not null,
			first_name varchar(50) not null,
			last_name varchar(50) not null,
			registered_on date default sysdate not null,
			last_login date
		)
		]]>
	</statement>
	<statement id="createTable2">
		<![CDATA[
		create table urls (
			id integer not null,
			users_id integer not null,
			url varchar(255) not null,
			title varchar(255) not null,
			description clob,
			added_on timestamp default sysdate not null,
			primary key (id), 
			foreign key (users_id) references users(id) on delete cascade
		)
		]]>
	</statement>
	<statement id="createFunction1">
		<![CDATA[
		create or replace function
		  findUsersLike(username in varchar) return sys_refcursor
		as
		  res sys_refcursor;
		begin
		  open res for
		    select u.* from users u where u.username like concat(username, '%');  
		  return res;
		end findUsersLike;
		]]>
	</statement>
	<statement id="createSequences">
		<![CDATA[
		begin
			execute immediate 'create sequence seq_users_id';
			execute immediate 'create sequence seq_urls_id';
		end;
		]]>
	</statement>
	
	<!-- Drop database objects -->
	<statement id="dropObjects">
		<![CDATA[
		begin
			execute immediate 'drop table urls cascade constraints';
			execute immediate 'drop table users cascade constraints';
			execute immediate 'drop function findUsersLike';
			execute immediate 'drop sequence seq_users_id';
			execute immediate 'drop sequence seq_urls_id';
		end;
		]]>
	</statement>
</sqlMap>