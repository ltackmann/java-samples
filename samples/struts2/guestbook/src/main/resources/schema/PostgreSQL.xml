<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
"http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="CreatePostgreSQLDatabase">
	<!-- Create statements -->
	<statement id="createSchema">
		<![CDATA[
		create schema strutsdemo
	]]>
	</statement>
	<statement id="createTable1">
		<![CDATA[
		create table strutsdemo.users (
			id integer not null primary key,
			username varchar(20) unique not null,
	    	first_name varchar(50) not null,
	    	last_name varchar(50) not null,
	    	registered_on timestamp not null default current_timestamp,
	    	last_login timestamp
		)
		]]>
	</statement>
	<statement id="createTable2">
		<![CDATA[
		create table strutsdemo.urls (
    		id integer not null,
    		users_id integer not null,
    		url varchar(255) not null,
    		title varchar(255) not null,
    		description text,
    		added_on timestamp not null default current_timestamp,
    		primary key (id), 
    		foreign key (users_id) references strutsdemo.users(id) on delete cascade
		)
		]]>
	</statement>
	<statement id="createFunction1">
		<![CDATA[
		create or replace function  
			strutsdemo.findUsersLike(username in varchar) returns refcursor as '
		declare 
			res refcursor;  
		begin  
			open res for  
				select * from strutsdemo.users u 
					where u.username like concat(username, "%");  
			return res;  
		end;
		' language plpgsql
	]]>
	</statement>

	<!-- Drop Statements -->
	<statement id="dropSchema">
		<![CDATA[
		drop schema strutsdemo cascade
	]]>
	</statement>
</sqlMap>